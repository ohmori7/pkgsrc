$NetBSD: patch-CVE-2018-17101,v 1.1.2.2 2018/10/29 14:49:32 bsiegert Exp $

Patch for CVE-2018-17101 from upstream git repo

--- tools/pal2rgb.c.orig	2015-08-28 22:17:08.000000000 +0000
+++ tools/pal2rgb.c
@@ -391,7 +392,23 @@ cpTags(TIFF* in, TIFF* out)
 {
     struct cpTag *p;
     for (p = tags; p < &tags[NTAGS]; p++)
+    {
+	if( p->tag == TIFFTAG_GROUP3OPTIONS )
+	{
+	    uint16 compression;
+	    if( !TIFFGetField(in, TIFFTAG_COMPRESSION, &compression) ||
+		    compression != COMPRESSION_CCITTFAX3 )
+		continue;
+	}
+	if( p->tag == TIFFTAG_GROUP4OPTIONS )
+	{
+	    uint16 compression;
+	    if( !TIFFGetField(in, TIFFTAG_COMPRESSION, &compression) ||
+		    compression != COMPRESSION_CCITTFAX4 )
+		continue;
+	}
 	cpTag(in, out, p->tag, p->count, p->type);
+    }
 }
 #undef NTAGS
 
--- tools/tiff2bw.c.orig	2017-11-01 13:41:58.000000000 +0000
+++ tools/tiff2bw.c
@@ -452,7 +452,23 @@ cpTags(TIFF* in, TIFF* out)
 {
     struct cpTag *p;
     for (p = tags; p < &tags[NTAGS]; p++)
+    {
+        if( p->tag == TIFFTAG_GROUP3OPTIONS )
+	{
+	    uint16 compression;
+	    if( !TIFFGetField(in, TIFFTAG_COMPRESSION, &compression) ||
+		    compression != COMPRESSION_CCITTFAX3 )
+		continue;
+	}
+	if( p->tag == TIFFTAG_GROUP4OPTIONS )
+	{
+	    uint16 compression;
+	    if( !TIFFGetField(in, TIFFTAG_COMPRESSION, &compression) ||
+		    compression != COMPRESSION_CCITTFAX4 )
+		continue;
+	}
 	cpTag(in, out, p->tag, p->count, p->type);
+    }
 }
 #undef NTAGS
 
